generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Course {
  id          String     @id @default(uuid())
  code        String     @unique @db.VarChar(20)
  name        String     @db.VarChar(200)
  description String?
  department  Department
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  sections    Section[]

  @@index([code])
  @@index([department])
  @@map("courses")
}

model Section {
  id                String           @id @default(uuid())
  sectionNumber     String           @db.VarChar(10)
  year              Int
  maxEnrollment     Int              @default(30)
  currentEnrollment Int              @default(0)
  courseId          String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  enrollments       Enrollment[]
  course            Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  teacherSections   TeacherSection[]

  @@unique([courseId, sectionNumber, year])
  @@index([courseId])
  @@index([year])
  @@map("sections")
}

model Student {
  id            String        @id @default(uuid())
  studentNumber String        @unique @db.VarChar(20)
  firstName     String        @db.VarChar(50)
  lastName      String        @db.VarChar(50)
  email         String        @unique @db.VarChar(100)
  phone         String?       @db.VarChar(20)
  dateOfBirth   DateTime?     @db.Date
  address       String?
  major         Department?
  status        StudentStatus @default(ACTIVE)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  enrollments   Enrollment[]

  @@index([studentNumber])
  @@index([email])
  @@index([major])
  @@index([status])
  @@map("students")
}

model Teacher {
  id              String           @id @default(uuid())
  firstName       String           @db.VarChar(50)
  lastName        String           @db.VarChar(50)
  email           String           @unique @db.VarChar(100)
  phone           String?          @db.VarChar(20)
  department      Department?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  teacherSections TeacherSection[]

  @@index([email])
  @@index([department])
  @@map("teachers")
}

model Enrollment {
  id         String           @id @default(uuid())
  grade      String?          @db.VarChar(5)
  status     EnrollmentStatus @default(ENROLLED)
  enrolledAt DateTime         @default(now())
  studentId  String
  sectionId  String
  section    Section          @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  student    Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, sectionId])
  @@index([studentId])
  @@index([sectionId])
  @@index([status])
  @@index([enrolledAt])
  @@map("enrollments")
}

model TeacherSection {
  id        String      @id @default(uuid())
  role      TeacherRole @default(LEAD_INSTRUCTOR)
  teacherId String
  sectionId String
  section   Section     @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  teacher   Teacher     @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@unique([teacherId, sectionId])
  @@index([teacherId])
  @@index([sectionId])
  @@index([role])
  @@map("teacher_sections")
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  GRADUATED
  ALUMNI
}

enum EnrollmentStatus {
  PENDING
  ENROLLED
  DROPPED
  COMPLETED
  FAILED
  IN_PROGRESS
}

enum TeacherRole {
  LEAD_INSTRUCTOR
  ASSISTANT_INSTRUCTOR
  TEACHING_ASSISTANT
  GUEST_LECTURER
}

enum Department {
  CCAB
  CETEC
}
